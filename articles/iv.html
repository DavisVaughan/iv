<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="iv">
<title>Introduction to iv • iv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to iv">
<meta property="og:description" content="iv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">iv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/iv.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DavisVaughan/iv/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to iv</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DavisVaughan/iv/blob/HEAD/vignettes/iv.Rmd" class="external-link"><code>vignettes/iv.Rmd</code></a></small>
      <div class="d-none name"><code>iv.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/iv" class="external-link">iv</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://clock.r-lib.org" class="external-link">clock</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>iv is a package dedicated to working with intervals in a generic way. It introduces a new type, the <strong>i</strong>nterval <strong>v</strong>ector, which is generally referred to as an <strong>iv</strong>. An iv is generally created from two parallel vectors representing the starts and ends of the intervals, like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Interval vector of integers</span>
<span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;integer&gt;[5]&gt;</span>
<span class="co">#&gt; [1] [1, 7)  [2, 8)  [3, 9)  [4, 10) [5, 11)</span>

<span class="co"># Interval vector of dates</span>
<span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span>
<span class="va">ends</span> <span class="op">&lt;-</span> <span class="va">starts</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>

<span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">starts</span>, <span class="va">ends</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;date&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [2019-01-01, 2019-01-03) [2019-01-02, 2019-01-07) [2019-01-03, 2019-01-13)</span></code></pre></div>
<p>The neat thing about interval vectors is that they are generic, so you can create them from any comparable type that is supported by vctrs. For example, the integer64 type from the bit64 package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu">bit64</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bit64/man/as.integer64.character.html" class="external-link">as.integer64</a></span><span class="op">(</span><span class="st">"900000000000"</span><span class="op">)</span>
<span class="va">end</span> <span class="op">&lt;-</span> <span class="va">start</span> <span class="op">+</span> <span class="fl">1234</span>

<span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;integer64&gt;[1]&gt;</span>
<span class="co">#&gt; [1] [900000000000, 900000001234)</span></code></pre></div>
<p>Or the year-month type from clock:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://clock.r-lib.org/reference/year_month_day.html" class="external-link">year_month_day</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2020</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://clock.r-lib.org/reference/year_month_day.html" class="external-link">year_month_day</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2020</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;year_month_day&lt;month&gt;&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [2019-01, 2020-02) [2020-03, 2020-06)</span></code></pre></div>
<p>The rest of this vignette explores some of the useful things that you can do with ivs.</p>
</div>
<div class="section level2">
<h2 id="structure">Structure<a class="anchor" aria-label="anchor" href="#structure"></a>
</h2>
<p>As mentioned above, ivs are created from two parallel vectors representing the starts and ends of the intervals.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;integer&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [1, 4) [2, 5) [3, 6)</span></code></pre></div>
<p>You can access the starts with <code><a href="../reference/iv-accessors.html">iv_start()</a></code> and the ends with <code><a href="../reference/iv-accessors.html">iv_end()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-accessors.html">iv_start</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="fu"><a href="../reference/iv-accessors.html">iv_end</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 4 5 6</span></code></pre></div>
<p>You can use an iv as a column in a data frame or tibble and it’ll work just fine!</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;           x</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;iv&lt;int&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    [1, 4)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    [2, 5)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    [3, 6)</span></code></pre></div>
<div class="section level3">
<h3 id="right-open-intervals">Right-open intervals<a class="anchor" aria-label="anchor" href="#right-open-intervals"></a>
</h3>
<p>The only interval type that is supported by iv is a <em>right-open</em> interval, i.e. <code>[a, b)</code>. While this might seem restrictive, it rarely ends up being a problem in practice, and often it aligns with the easiest way to express a particular interval. For example, consider an interval that spans the entire day of <code>2019-01-02</code>. If you wanted to represent this interval with second precision with a right-open interval, you’d do <code>[2019-01-02 00:00:00, 2019-01-03 00:00:00)</code>. This nicely captures the exclusive “end” of the interval as the start of the next day. This also means it exactly aligns with the start of the <em>next</em> day’s interval, <code>[2019-01-03 00:00:00, 2019-01-04 00:00:00)</code>.</p>
<p>If you wanted to represent this with a closed interval, you might do <code>[2019-01-02 00:00:00, 2019-01-02 23:59:59)</code>. Not only is this a bit awkward, it can also cause issues if the precision changes! Say you wanted to up the precision on this interval from second level precision to millisecond precision. The right-open interval wouldn’t have to change at all since the end of that interval is set to <code>2019-01-03 00:00:00</code> and anything before that is fair game. But the closed interval can’t be naively changed from <code>2019-01-02 23:59:59</code> to <code>2019-01-02 23:59:59.000</code>, as you’d lose the 999 milliseconds in that last second. Extra care would have to be taken to set the milliseconds to <code>2019-01-02 23:59:59.999</code>.</p>
<p>If you still aren’t convinced, I’d encourage you to take a look at these resources that also advocate for right-open intervals:</p>
<ul>
<li><p><a href="https://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html" class="external-link">Why numbering should start at 0</a></p></li>
<li><p>These two Stack Overflow posts (<a href="https://stackoverflow.com/questions/9795391/is-there-a-standard-for-inclusive-exclusive-ends-of-time-intervals" class="external-link">1</a>, <a href="https://stackoverflow.com/questions/8441749/representing-intervals-or-ranges" class="external-link">2</a>) that expand on the above paper</p></li>
<li><p><a href="http://wrschneider.github.io/2014/01/07/time-intervals-and-other-ranges-should.html" class="external-link">Time intervals and other ranges should be half-open</a></p></li>
</ul>
</div>
<div class="section level3">
<h3 id="empty-intervals">Empty intervals<a class="anchor" aria-label="anchor" href="#empty-intervals"></a>
</h3>
<p>In iv, it is required that <code>start &lt; end</code> when generating an interval vector. This means that intervals like <code>[5, 2)</code> are invalid, but it also means that an “empty” interval of <code>[5, 5)</code> is also invalid. Practically, I’ve found that attempting to allow these ends up resulting in more implementation headaches than anything else, and they don’t end up having very many uses.</p>
</div>
</div>
<div class="section level2">
<h2 id="finding-overlaps">Finding overlaps<a class="anchor" aria-label="anchor" href="#finding-overlaps"></a>
</h2>
<p>One of the most compelling reasons to use iv is that it tries to make finding overlapping intervals as easy as possible. <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code> takes two ivs and returns a data frame containing information about where they overlap. It works somewhat like <code><a href="https://rdrr.io/r/base/match.html" class="external-link">base::match()</a></code> in that for each element of <code>needles</code>, it looks for a match in <em>all</em> of <code>haystack</code>. Unlike <code><a href="https://rdrr.io/r/base/match.html" class="external-link">match()</a></code>, it actually returns all of the overlaps rather than just the first.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># iv_pairs() is a useful way to create small ivs from individual intervals</span>
<span class="va">needles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>
<span class="va">needles</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [1, 5)   [3, 7)   [10, 12)</span>

<span class="va">haystack</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="va">haystack</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[5]&gt;</span>
<span class="co">#&gt; [1] [0, 6)   [13, 15) [0, 2)   [7, 8)   [4, 5)</span>

<span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_overlaps</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span><span class="op">)</span>
<span class="va">locations</span>
<span class="co">#&gt;   needles haystack</span>
<span class="co">#&gt; 1       1        1</span>
<span class="co">#&gt; 2       1        3</span>
<span class="co">#&gt; 3       1        5</span>
<span class="co">#&gt; 4       2        1</span>
<span class="co">#&gt; 5       2        5</span>
<span class="co">#&gt; 6       3       NA</span></code></pre></div>
<p>The <code>$needles</code> column of the result is an integer vector showing where to slice <code>needles</code> to generate the intervals that overlap the intervals in <code>haystack</code> described by the <code>$haystack</code> column. When a needle doesn’t overlap with any intervals in the haystack, an <code>NA</code> location is returned. An easy way to align both <code>needles</code> and <code>haystack</code> using this information is to pass everything to <code><a href="../reference/iv_align.html">iv_align()</a></code>, which will automatically perform the slicing and store the results in another data frame:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>
<span class="co">#&gt;    needles haystack</span>
<span class="co">#&gt; 1   [1, 5)   [0, 6)</span>
<span class="co">#&gt; 2   [1, 5)   [0, 2)</span>
<span class="co">#&gt; 3   [1, 5)   [4, 5)</span>
<span class="co">#&gt; 4   [3, 7)   [0, 6)</span>
<span class="co">#&gt; 5   [3, 7)   [4, 5)</span>
<span class="co">#&gt; 6 [10, 12) [NA, NA)</span></code></pre></div>
<p>If you just wanted to know if an interval in <code>needles</code> overlapped <em>any</em> interval in <code>haystack</code>, then you can use <code><a href="../reference/relation-detect.html">iv_overlaps()</a></code>, which returns a logical vector.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/relation-detect.html">iv_overlaps</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span><span class="op">)</span>
<span class="co">#&gt; [1]  TRUE  TRUE FALSE</span></code></pre></div>
<p>By default, <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code> will detect if there is any kind of overlap between the two inputs, but there are various other <code>type</code>s of overlaps that you can detect. For example, you can check if <code>needles</code> “contains” <code>haystack</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_overlaps</a></span><span class="op">(</span>
  <span class="va">needles</span>, 
  <span class="va">haystack</span>, 
  type <span class="op">=</span> <span class="st">"contains"</span>, 
  no_match <span class="op">=</span> <span class="st">"drop"</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>
<span class="co">#&gt;   needles haystack</span>
<span class="co">#&gt; 1  [1, 5)   [4, 5)</span>
<span class="co">#&gt; 2  [3, 7)   [4, 5)</span></code></pre></div>
<p>I’ve also used <code>no_match = "drop"</code> to drop all of the <code>needles</code> that don’t have any matching overlaps.</p>
<p>You can also check for the reverse, i.e. if <code>needles</code> is “within” the <code>haystack</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_overlaps</a></span><span class="op">(</span>
  <span class="va">needles</span>, 
  <span class="va">haystack</span>, 
  type <span class="op">=</span> <span class="st">"within"</span>, 
  no_match <span class="op">=</span> <span class="st">"drop"</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>
<span class="co">#&gt;   needles haystack</span>
<span class="co">#&gt; 1  [1, 5)   [0, 6)</span></code></pre></div>
<div class="section level3">
<h3 id="precedes-follows">Precedes / Follows<a class="anchor" aria-label="anchor" href="#precedes-follows"></a>
</h3>
<p>Two other functions that are related to <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code> are <code><a href="../reference/relation-locate.html">iv_locate_precedes()</a></code> and <code><a href="../reference/relation-locate.html">iv_locate_follows()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Where does `needles` precede `haystack`?</span>
<span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_precedes</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span><span class="op">)</span>
<span class="va">locations</span>
<span class="co">#&gt;   needles haystack</span>
<span class="co">#&gt; 1       1        2</span>
<span class="co">#&gt; 2       1        4</span>
<span class="co">#&gt; 3       2        2</span>
<span class="co">#&gt; 4       2        4</span>
<span class="co">#&gt; 5       3        2</span></code></pre></div>
<p>This returns a data frame of the same structure as <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code>, so you can use it with <code><a href="../reference/iv_align.html">iv_align()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>
<span class="co">#&gt;    needles haystack</span>
<span class="co">#&gt; 1   [1, 5) [13, 15)</span>
<span class="co">#&gt; 2   [1, 5)   [7, 8)</span>
<span class="co">#&gt; 3   [3, 7) [13, 15)</span>
<span class="co">#&gt; 4   [3, 7)   [7, 8)</span>
<span class="co">#&gt; 5 [10, 12) [13, 15)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Where does `needles` follow `haystack`?</span>
<span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_follows</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span><span class="op">)</span>

<span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>
<span class="co">#&gt;    needles haystack</span>
<span class="co">#&gt; 1   [1, 5) [NA, NA)</span>
<span class="co">#&gt; 2   [3, 7)   [0, 2)</span>
<span class="co">#&gt; 3 [10, 12)   [0, 6)</span>
<span class="co">#&gt; 4 [10, 12)   [0, 2)</span>
<span class="co">#&gt; 5 [10, 12)   [7, 8)</span>
<span class="co">#&gt; 6 [10, 12)   [4, 5)</span></code></pre></div>
<p>If you are only interested in the closest interval in <code>haystack</code> that the needle precedes or follows, set <code>closest = TRUE</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_follows</a></span><span class="op">(</span>
  needles <span class="op">=</span> <span class="va">needles</span>, 
  haystack <span class="op">=</span> <span class="va">haystack</span>, 
  closest <span class="op">=</span> <span class="cn">TRUE</span>,
  no_match <span class="op">=</span> <span class="st">"drop"</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>
<span class="co">#&gt;    needles haystack</span>
<span class="co">#&gt; 1   [3, 7)   [0, 2)</span>
<span class="co">#&gt; 2 [10, 12)   [7, 8)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="allens-interval-algebra">Allen’s Interval Algebra<a class="anchor" aria-label="anchor" href="#allens-interval-algebra"></a>
</h3>
<p><a href="https://cse.unl.edu/~choueiry/Documents/Allen-CACM1983.pdf" class="external-link">Maintaining Knowledge about Temporal Intervals</a> is a great paper by James Allen that outlines an interval algebra that completely describes how any two intervals are related to each other (i.e. if one interval precedes, overlaps, or is met-by another interval). The paper describes 13 relations that make up this algebra, which are faithfully implemented in <code><a href="../reference/allen-relation-locate.html">iv_locate_relates()</a></code> and <code><a href="../reference/allen-relation-detect.html">iv_relates()</a></code>. These relations are extremely useful because they are <em>distinct</em> (i.e. two intervals can only be related by exactly 1 of the 13 relations), but they are a bit too restrictive to be practically useful. <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code>, <code><a href="../reference/relation-locate.html">iv_locate_precedes()</a></code>, and <code><a href="../reference/relation-locate.html">iv_locate_follows()</a></code> combine multiple of the individual relations into three broad ideas that I find most useful. If you want to learn more about this, I’d encourage you to read the help documentation for <code><a href="../reference/allen-relation-locate.html">iv_locate_relates()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="between-ness">Between-ness<a class="anchor" aria-label="anchor" href="#between-ness"></a>
</h3>
<p>Often you just want to know if a vector of values falls between the bounds of an interval. This is particularly common with dates, where you might want to know if a sale you made corresponded to an interval range when any commercial was being run.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-01-01"</span>, <span class="st">"2020-05-10"</span>, <span class="st">"2020-06-10"</span><span class="op">)</span><span class="op">)</span>

<span class="va">commercial_starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
  <span class="st">"2019-10-12"</span>, <span class="st">"2020-04-01"</span>, <span class="st">"2020-06-01"</span>, <span class="st">"2021-05-10"</span>
<span class="op">)</span><span class="op">)</span>
<span class="va">commercial_ends</span> <span class="op">&lt;-</span> <span class="va">commercial_starts</span> <span class="op">+</span> <span class="fl">90</span>

<span class="va">commercials</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">commercial_starts</span>, <span class="va">commercial_ends</span><span class="op">)</span>

<span class="va">sales</span>
<span class="co">#&gt; [1] "2019-01-01" "2020-05-10" "2020-06-10"</span>
<span class="va">commercials</span>
<span class="co">#&gt; &lt;iv&lt;date&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [2019-10-12, 2020-01-10) [2020-04-01, 2020-06-30) [2020-06-01, 2020-08-30)</span>
<span class="co">#&gt; [4] [2021-05-10, 2021-08-08)</span></code></pre></div>
<p>You can check if a sale was made while any commercial was being run with <code><a href="../reference/iv_between.html">iv_between()</a></code>, which works like <code>%in%</code> and is similar to <code><a href="../reference/relation-detect.html">iv_overlaps()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>sales <span class="op">=</span> <span class="va">sales</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>commercial_running <span class="op">=</span> <span class="fu"><a href="../reference/iv_between.html">iv_between</a></span><span class="op">(</span><span class="va">sales</span>, <span class="va">commercials</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span>
<span class="co">#&gt;   sales      commercial_running</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019-01-01 FALSE             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020-05-10 TRUE              </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2020-06-10 TRUE</span></code></pre></div>
<p>You can find the commercials that were airing when the sale was made with <code><a href="../reference/iv_locate_between.html">iv_locate_between()</a></code> and <code><a href="../reference/iv_align.html">iv_align()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">sales</span>, <span class="va">commercials</span>, locations <span class="op">=</span> <span class="fu"><a href="../reference/iv_locate_between.html">iv_locate_between</a></span><span class="op">(</span><span class="va">sales</span>, <span class="va">commercials</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;      needles                 haystack</span>
<span class="co">#&gt; 1 2019-01-01                 [NA, NA)</span>
<span class="co">#&gt; 2 2020-05-10 [2020-04-01, 2020-06-30)</span>
<span class="co">#&gt; 3 2020-06-10 [2020-04-01, 2020-06-30)</span>
<span class="co">#&gt; 4 2020-06-10 [2020-06-01, 2020-08-30)</span></code></pre></div>
<p>If you aren’t looking for the <code>%in%</code>-like behavior of <code><a href="../reference/iv_between.html">iv_between()</a></code>, and instead want to pairwise detect whether one value falls between an interval or not, you can use <code><a href="../reference/iv_pairwise_between.html">iv_pairwise_between()</a></code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; [1]  1  5 10 12</span>

<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [0, 6)   [7, 9)   [10, 12) [10, 12)</span>

<span class="fu"><a href="../reference/iv_pairwise_between.html">iv_pairwise_between</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1]  TRUE FALSE  TRUE FALSE</span></code></pre></div>
<p>Keep in mind that the intervals are half-open, so <code>12</code> doesn’t fall between the interval of <code>[10, 12)</code>! This is different from <code><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">dplyr::between()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="counting-overlaps">Counting overlaps<a class="anchor" aria-label="anchor" href="#counting-overlaps"></a>
</h2>
<p>Sometimes you just need the counts of the number of overlaps rather than the actual locations of them. For example, say your business has a subscription service and you’d like to compute a rolling monthly count of the total number of subscriptions that are active (i.e. in January 2019, how many subscriptions were active?). Customers are only allowed to have one subscription active at once, but they may cancel it and reactivate it at any time. If a customer was active at any point during the month, then they are counted in that month.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">enrollments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">name</span>,      <span class="op">~</span><span class="va">start</span>,          <span class="op">~</span><span class="va">end</span>,
  <span class="st">"Amy"</span>,      <span class="st">"1, Jan, 2017"</span>,  <span class="st">"30, Jul, 2018"</span>,
  <span class="st">"Franklin"</span>, <span class="st">"1, Jan, 2017"</span>,  <span class="st">"19, Feb, 2017"</span>,
  <span class="st">"Franklin"</span>, <span class="st">"5, Jun, 2017"</span>,  <span class="st">"4, Feb, 2018"</span>,
  <span class="st">"Franklin"</span>, <span class="st">"21, Oct, 2018"</span>, <span class="st">"9, Mar, 2019"</span>,
  <span class="st">"Samir"</span>,    <span class="st">"1, Jan, 2017"</span>,  <span class="st">"4, Feb, 2017"</span>,
  <span class="st">"Samir"</span>,    <span class="st">"5, Apr, 2017"</span>,  <span class="st">"12, Jun, 2018"</span>
<span class="op">)</span>

<span class="co"># Parse these into "day" precision year-month-day objects</span>
<span class="va">enrollments</span> <span class="op">&lt;-</span> <span class="va">enrollments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fu"><a href="https://clock.r-lib.org/reference/year_month_day_parse.html" class="external-link">year_month_day_parse</a></span><span class="op">(</span><span class="va">start</span>, format <span class="op">=</span> <span class="st">"%d, %b, %Y"</span><span class="op">)</span>,
    end <span class="op">=</span> <span class="fu"><a href="https://clock.r-lib.org/reference/year_month_day_parse.html" class="external-link">year_month_day_parse</a></span><span class="op">(</span><span class="va">end</span>, format <span class="op">=</span> <span class="st">"%d, %b, %Y"</span><span class="op">)</span>,
  <span class="op">)</span>

<span class="va">enrollments</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   name     start      end       </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;ymd&lt;day&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ymd&lt;day&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Amy      2017-01-01 2018-07-30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Franklin 2017-01-01 2017-02-19</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Franklin 2017-06-05 2018-02-04</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Franklin 2018-10-21 2019-03-09</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Samir    2017-01-01 2017-02-04</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Samir    2017-04-05 2018-06-12</span></code></pre></div>
<p>Even though we have day precision information, we only actually need month precision intervals to answer this question. We’ll use <code><a href="https://clock.r-lib.org/reference/calendar_narrow.html" class="external-link">calendar_narrow()</a></code> from clock to convert our <code>"day"</code> precision dates to <code>"month"</code> precision ones. We’ll also add 1 month to the <code>end</code> intervals to reflect the fact that the end month is open (remember, ivs are half-open).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">enrollments</span> <span class="op">&lt;-</span> <span class="va">enrollments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fu"><a href="https://clock.r-lib.org/reference/calendar_narrow.html" class="external-link">calendar_narrow</a></span><span class="op">(</span><span class="va">start</span>, <span class="st">"month"</span><span class="op">)</span>,
    end <span class="op">=</span> <span class="fu"><a href="https://clock.r-lib.org/reference/calendar_narrow.html" class="external-link">calendar_narrow</a></span><span class="op">(</span><span class="va">end</span>, <span class="st">"month"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1L</span>
  <span class="op">)</span>

<span class="va">enrollments</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   name     start        end         </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;ymd&lt;month&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ymd&lt;month&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Amy      2017-01      2018-08     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Franklin 2017-01      2017-03     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Franklin 2017-06      2018-03     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Franklin 2018-10      2019-04     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Samir    2017-01      2017-03     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Samir    2017-04      2018-07</span>

<span class="va">enrollments</span> <span class="op">&lt;-</span> <span class="va">enrollments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>active <span class="op">=</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span>, .keep <span class="op">=</span> <span class="st">"unused"</span><span class="op">)</span>

<span class="va">enrollments</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span>
<span class="co">#&gt;   name                 active</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;iv&lt;ymd&lt;month&gt;&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Amy      [2017-01, 2018-08)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Franklin [2017-01, 2017-03)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Franklin [2017-06, 2018-03)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Franklin [2018-10, 2019-04)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Samir    [2017-01, 2017-03)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Samir    [2017-04, 2018-07)</span></code></pre></div>
<p>To answer this question, we are going to need to create a sequential vector of months that span the entire range of intervals. This starts at the smallest <code>start</code> and goes to the largest <code>end</code>. Because the <code>end</code> is half-open, there won’t be any hits for that month, so we won’t include it.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">enrollments</span><span class="op">$</span><span class="va">active</span><span class="op">)</span>
<span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv-accessors.html">iv_start</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv-accessors.html">iv_end</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span>

<span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">lower</span>, <span class="va">upper</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">months</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 1</span></span>
<span class="co">#&gt;    month       </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;ymd&lt;month&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2017-01     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2017-02     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2017-03     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2017-04     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2017-05     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2017-06     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2017-07     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2017-08     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2017-09     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2017-10     </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 17 more rows</span></span></code></pre></div>
<p>Now we need to add a column to <code>months</code> to represent the number of subscriptions that were active in that month. To do this we can use <code><a href="../reference/iv_count_between.html">iv_count_between()</a></code>. It works like <code><a href="../reference/iv_between.html">iv_between()</a></code> and <code><a href="../reference/iv_locate_between.html">iv_locate_between()</a></code> but returns an integer vector corresponding to the number of times the <code>i</code>-th “needle” value fell between any of the values in the “haystack”.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">months</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="../reference/iv_count_between.html">iv_count_between</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">enrollments</span><span class="op">$</span><span class="va">active</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 2</span></span>
<span class="co">#&gt;    month        count</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;ymd&lt;month&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2017-01          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2017-02          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2017-03          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2017-04          2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2017-05          2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2017-06          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2017-07          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2017-08          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2017-09          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2017-10          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2017-11          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2017-12          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 2018-01          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 2018-02          3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 2018-03          2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 2018-04          2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 2018-05          2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 2018-06          2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 2018-07          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">20</span> 2018-08          0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">21</span> 2018-09          0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">22</span> 2018-10          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">23</span> 2018-11          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">24</span> 2018-12          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">25</span> 2019-01          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">26</span> 2019-02          1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">27</span> 2019-03          1</span></code></pre></div>
<p>There are also <code><a href="../reference/relation-count.html">iv_count_overlaps()</a></code>, <code><a href="../reference/relation-count.html">iv_count_precedes()</a></code>, and <code><a href="../reference/relation-count.html">iv_count_follows()</a></code> for working with two ivs at once.</p>
</div>
<div class="section level2">
<h2 id="grouping-by-overlaps">Grouping by overlaps<a class="anchor" aria-label="anchor" href="#grouping-by-overlaps"></a>
</h2>
<p>One common operation when working with interval vectors is merging all the overlapping intervals within a single interval vector. This removes all the redundant information, while still maintaining the full range covered by the iv. For this, you can use <code><a href="../reference/iv-groups.html">iv_groups()</a></code> which computes the minimal set of interval “groups” that contain all of the intervals in <code>x</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[5]&gt;</span>
<span class="co">#&gt; [1] [1, 5)   [5, 7)   [9, 11)  [10, 13) [12, 13)</span>

<span class="fu"><a href="../reference/iv-groups.html">iv_groups</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [1, 7)  [9, 13)</span></code></pre></div>
<p>By default, this grouped <em>abutting</em> intervals that aren’t considered to overlap but also don’t have any values between them. If you don’t want this, use the <code>abutting</code> argument.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-groups.html">iv_groups</a></span><span class="op">(</span><span class="va">x</span>, abutting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [1, 5)  [5, 7)  [9, 13)</span></code></pre></div>
<div class="section level3">
<h3 id="with-group_by">With <code>group_by()</code><a class="anchor" aria-label="anchor" href="#with-group_by"></a>
</h3>
<p>Grouping overlapping intervals is often a useful way to create a new variable to group on with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code>. For example, consider the following problem where you have multiple users racking up costs across multiple systems. The date ranges represent the range when the corresponding cost was accrued over, and the ranges don’t overlap for a given <code>(user, system)</code> pair.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">user</span>, <span class="op">~</span><span class="va">system</span>, <span class="op">~</span><span class="va">from</span>, <span class="op">~</span><span class="va">to</span>, <span class="op">~</span><span class="va">cost</span>,
  <span class="fl">1L</span>, <span class="st">"a"</span>, <span class="st">"2019-01-01"</span>, <span class="st">"2019-01-05"</span>, <span class="fl">200.5</span>,
  <span class="fl">1L</span>, <span class="st">"a"</span>, <span class="st">"2019-01-12"</span>, <span class="st">"2019-01-13"</span>, <span class="fl">15.6</span>,
  <span class="fl">1L</span>, <span class="st">"b"</span>, <span class="st">"2019-01-03"</span>, <span class="st">"2019-01-10"</span>, <span class="fl">500.3</span>,
  <span class="fl">2L</span>, <span class="st">"a"</span>, <span class="st">"2019-01-02"</span>, <span class="st">"2019-01-03"</span>, <span class="fl">25.6</span>,
  <span class="fl">2L</span>, <span class="st">"c"</span>, <span class="st">"2019-01-03"</span>, <span class="st">"2019-01-04"</span>, <span class="fl">30</span>,
  <span class="fl">2L</span>, <span class="st">"c"</span>, <span class="st">"2019-01-05"</span>, <span class="st">"2019-01-07"</span>, <span class="fl">66.2</span>
<span class="op">)</span>

<span class="va">costs</span> <span class="op">&lt;-</span> <span class="va">costs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">from</span><span class="op">)</span>,
    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">to</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span>, .keep <span class="op">=</span> <span class="st">"unused"</span><span class="op">)</span>

<span class="va">costs</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">#&gt;    user system  cost                    range</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;iv&lt;date&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 a      200.  [2019-01-01, 2019-01-05)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 a       15.6 [2019-01-12, 2019-01-13)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 b      500.  [2019-01-03, 2019-01-10)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2 a       25.6 [2019-01-02, 2019-01-03)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2 c       30   [2019-01-03, 2019-01-04)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2 c       66.2 [2019-01-05, 2019-01-07)</span></code></pre></div>
<p>Now let’s say you don’t care about the <code>system</code> anymore, and instead want to sum up the costs for any overlapping date ranges for a particular <code>user</code>. <code><a href="../reference/iv-groups.html">iv_groups()</a></code> can give us an idea of what the non-overlapping ranges would be for each user:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">costs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">user</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="../reference/iv-groups.html">iv_groups</a></span><span class="op">(</span><span class="va">range</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span>
<span class="co">#&gt;    user                    range</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;iv&lt;date&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 [2019-01-01, 2019-01-10)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 [2019-01-12, 2019-01-13)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2 [2019-01-02, 2019-01-04)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2 [2019-01-05, 2019-01-07)</span></code></pre></div>
<p>But how can we sum up the costs? For this, we need to turn to <code><a href="../reference/iv-groups.html">iv_identify_group()</a></code> which allows us to identify the group that each <code>range</code> falls in. This will give us something to group on so we can sum up the costs.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">costs2</span> <span class="op">&lt;-</span> <span class="va">costs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">user</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="../reference/iv-groups.html">iv_identify_group</a></span><span class="op">(</span><span class="va">range</span><span class="op">)</span><span class="op">)</span>

<span class="co"># `range` has been updated with the corresponding group</span>
<span class="va">costs2</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   user [2]</span></span>
<span class="co">#&gt;    user system  cost                    range</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;iv&lt;date&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 a      200.  [2019-01-01, 2019-01-10)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 a       15.6 [2019-01-12, 2019-01-13)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 b      500.  [2019-01-01, 2019-01-10)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2 a       25.6 [2019-01-02, 2019-01-04)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2 c       30   [2019-01-02, 2019-01-04)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2 c       66.2 [2019-01-05, 2019-01-07)</span>

<span class="co"># So now we can group on that to summarise the cost</span>
<span class="va">costs2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">range</span>, .add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span>
<span class="co">#&gt;    user                    range  cost</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;iv&lt;date&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 [2019-01-01, 2019-01-10) 701. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 [2019-01-12, 2019-01-13)  15.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2 [2019-01-02, 2019-01-04)  55.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2 [2019-01-05, 2019-01-07)  66.2</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="minimal-ivs">Minimal ivs<a class="anchor" aria-label="anchor" href="#minimal-ivs"></a>
</h3>
<p><code><a href="../reference/iv-groups.html">iv_groups()</a></code> is a critical function in this package because its defaults also produce what is known as a <em>minimal</em> iv. A minimal interval vector:</p>
<ul>
<li><p>Has no overlapping intervals</p></li>
<li><p>Has no abutting intervals</p></li>
<li><p>Is ordered on both <code>iv_start(x)</code> and <code>iv_end(x)</code></p></li>
</ul>
<p>Minimal interval vectors are nice because they cover the range of an interval vector in the most compact form possible. They are also nice to know about because the set operations described in the set operations section below all return minimal interval vectors.</p>
</div>
</div>
<div class="section level2">
<h2 id="splitting-on-endpoints">Splitting on endpoints<a class="anchor" aria-label="anchor" href="#splitting-on-endpoints"></a>
</h2>
<p>While <code><a href="../reference/iv-groups.html">iv_groups()</a></code> generates <em>less</em> intervals than you began with, it is sometimes useful to go the other way and generate <em>more</em> intervals by splitting on all the overlapping endpoints. This is what <code><a href="../reference/iv-splits.html">iv_splits()</a></code> does. Both operations end up generating a result that contains completely disjoint intervals, but they go about it in very different ways.</p>
<p>Let’s look back at our first <code><a href="../reference/iv-groups.html">iv_groups()</a></code> example:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[5]&gt;</span>
<span class="co">#&gt; [1] [1, 5)   [5, 7)   [9, 11)  [10, 13) [12, 13)</span></code></pre></div>
<p>Notice that <code>[9, 11)</code> overlaps <code>[10, 13)</code> which in turn overlaps <code>[12, 13)</code>. If we looked at the sorted unique values of the endpoints (i.e. <code>c(9, 10, 11, 12, 13)</code>) and then paired these up like <code>[9, 10), [10, 11), [11, 12], [12, 13)</code>, then we will have nicely split on the endpoints, generating a disjoint set of intervals that we refer to as “splits”. <code><a href="../reference/iv-splits.html">iv_splits()</a></code> returns these intervals.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-splits.html">iv_splits</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[6]&gt;</span>
<span class="co">#&gt; [1] [1, 5)   [5, 7)   [9, 10)  [10, 11) [11, 12) [12, 13)</span></code></pre></div>
<div class="section level3">
<h3 id="with-group_by-1">With <code>group_by()</code><a class="anchor" aria-label="anchor" href="#with-group_by-1"></a>
</h3>
<p>Splitting an iv into its disjoint pieces is another operation that works nicely with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>. Consider this data set containing details about a number of guests that arrived to your party. You’ve been meticulous, so you’ve got their arrival and departure times logged (don’t ask me why, maybe it’s for COVID-19 Contact Tracing purposes).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  arrive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2008-05-20 19:30:00"</span>, <span class="st">"2008-05-20 20:10:00"</span>, <span class="st">"2008-05-20 22:15:00"</span><span class="op">)</span>,
    tz <span class="op">=</span> <span class="st">"UTC"</span>
  <span class="op">)</span>,
  depart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2008-05-20 23:00:00"</span>, <span class="st">"2008-05-21 00:00:00"</span>, <span class="st">"2008-05-21 00:30:00"</span><span class="op">)</span>,
    tz <span class="op">=</span> <span class="st">"UTC"</span>
  <span class="op">)</span>,
  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mary"</span>, <span class="st">"Harry"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Diana"</span>, <span class="st">"Susan"</span><span class="op">)</span>,
    <span class="st">"Peter"</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">guests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">guests</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>iv <span class="op">=</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">arrive</span>, <span class="va">depart</span><span class="op">)</span>, .keep <span class="op">=</span> <span class="st">"unused"</span><span class="op">)</span>

<span class="va">guests</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="co">#&gt;   name                                          iv</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;iv&lt;dttm&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Mary  [2008-05-20 19:30:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Harry [2008-05-20 19:30:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Diana [2008-05-20 20:10:00, 2008-05-21 00:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Susan [2008-05-20 20:10:00, 2008-05-21 00:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Peter [2008-05-20 22:15:00, 2008-05-21 00:30:00)</span></code></pre></div>
<p>Let’s figure out who was at your party at any given point throughout the night. To do this, we’ll need to break <code>iv</code> up into all possible disjoint intervals that mark either an arrival or departure. Like with <code><a href="../reference/iv-groups.html">iv_groups()</a></code>, <code><a href="../reference/iv-splits.html">iv_splits()</a></code> can show us those disjoint intervals, but this doesn’t help us map them back to each guest.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-splits.html">iv_splits</a></span><span class="op">(</span><span class="va">guests</span><span class="op">$</span><span class="va">iv</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;datetime&lt;UTC&gt;&gt;[5]&gt;</span>
<span class="co">#&gt; [1] [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span>
<span class="co">#&gt; [2] [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span>
<span class="co">#&gt; [3] [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; [4] [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span>
<span class="co">#&gt; [5] [2008-05-21 00:00:00, 2008-05-21 00:30:00)</span></code></pre></div>
<p>Instead, we’ll need <code><a href="../reference/iv-splits.html">iv_identify_splits()</a></code>, which identifies which of the splits overlap with each of the original intervals and returns a list of the results which works nicely as a list-column. This is a little easier to understand if we first look at a single guest:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mary's arrival/departure times</span>
<span class="va">guests</span><span class="op">$</span><span class="va">iv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; &lt;iv&lt;datetime&lt;UTC&gt;&gt;[1]&gt;</span>
<span class="co">#&gt; [1] [2008-05-20 19:30:00, 2008-05-20 23:00:00)</span>

<span class="co"># The first start and last end correspond to Mary's original times,</span>
<span class="co"># but we've also broken her stay up by the departures/arrivals of</span>
<span class="co"># everyone else</span>
<span class="fu"><a href="../reference/iv-splits.html">iv_identify_splits</a></span><span class="op">(</span><span class="va">guests</span><span class="op">$</span><span class="va">iv</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; &lt;iv&lt;datetime&lt;UTC&gt;&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span>
<span class="co">#&gt; [2] [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span>
<span class="co">#&gt; [3] [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></code></pre></div>
<p>Since this generates a list-column, we’ll also immediately use <code><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">tidyr::unnest()</a></code> to expand it out.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guests2</span> <span class="op">&lt;-</span> <span class="va">guests</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>iv <span class="op">=</span> <span class="fu"><a href="../reference/iv-splits.html">iv_identify_splits</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span>

<span class="va">guests2</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 2</span></span>
<span class="co">#&gt;    name                                          iv</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;iv&lt;dttm&gt;&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Mary  [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Harry [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Mary  [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Harry [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Diana [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Susan [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Mary  [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Harry [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Diana [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Susan [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Peter [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Diana [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Susan [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Peter [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Peter [2008-05-21 00:00:00, 2008-05-21 00:30:00)</span></code></pre></div>
<p>Now that we have the splits for each guest, we can group by <code>iv</code> and summarize to figure out who was at the party at any point throughout the night.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guests2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, who <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span>
<span class="co">#&gt;                                           iv     n who      </span>
<span class="co">#&gt;                                   <span style="color: #949494; font-style: italic;">&lt;iv&lt;dttm&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> [2008-05-20 19:30:00, 2008-05-20 20:10:00)     2 <span style="color: #949494;">&lt;chr [2]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> [2008-05-20 20:10:00, 2008-05-20 22:15:00)     4 <span style="color: #949494;">&lt;chr [4]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> [2008-05-20 22:15:00, 2008-05-20 23:00:00)     5 <span style="color: #949494;">&lt;chr [5]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> [2008-05-20 23:00:00, 2008-05-21 00:00:00)     3 <span style="color: #949494;">&lt;chr [3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> [2008-05-21 00:00:00, 2008-05-21 00:30:00)     1 <span style="color: #949494;">&lt;chr [1]&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="set-operations">Set operations<a class="anchor" aria-label="anchor" href="#set-operations"></a>
</h2>
<p>There are a number of set theoretical operations that you can use on ivs. These are:</p>
<ul>
<li><p><code><a href="../reference/iv-sets.html">iv_complement()</a></code></p></li>
<li><p><code><a href="../reference/iv-sets.html">iv_union()</a></code></p></li>
<li><p><code><a href="../reference/iv-sets.html">iv_intersect()</a></code></p></li>
<li><p><code><a href="../reference/iv-sets.html">iv_difference()</a></code></p></li>
<li><p><code><a href="../reference/iv-sets.html">iv_symmetric_difference()</a></code></p></li>
</ul>
<p><code><a href="../reference/iv-sets.html">iv_complement()</a></code> works on a single iv, while all the others work on two intervals at a time. All of these functions return a <em>minimal</em> interval vector. The easiest way to think about these functions is to imagine <code><a href="../reference/iv-groups.html">iv_groups()</a></code> being called on each of the inputs first (to reduce them down to their minimal form) before applying the operation.</p>
<p><code><a href="../reference/iv-sets.html">iv_complement()</a></code> computes the set complement of the intervals in a single iv.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [1, 3)   [2, 5)   [10, 12) [13, 15)</span>

<span class="fu"><a href="../reference/iv-sets.html">iv_complement</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [5, 10)  [12, 13)</span></code></pre></div>
<p>By default, <code><a href="../reference/iv-sets.html">iv_complement()</a></code> uses the smallest/largest values of its input as the bounds to compute the complement over, but you can supply bounds explicitly with <code>lower</code> and <code>upper</code>:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-sets.html">iv_complement</a></span><span class="op">(</span><span class="va">x</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [0, 1)    [5, 10)   [12, 13)  [15, Inf)</span></code></pre></div>
<p><code><a href="../reference/iv-sets.html">iv_union()</a></code> takes the union of two ivs. It is essentially a call to <code><a href="https://vctrs.r-lib.org/reference/vec_c.html" class="external-link">vctrs::vec_c()</a></code> followed by <code><a href="../reference/iv-groups.html">iv_groups()</a></code>. It answers the question, “Which intervals are in <code>x</code> or <code>y</code>?”</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>

<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [1, 3)   [2, 5)   [10, 12) [13, 15)</span>
<span class="va">y</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [-5, 0)  [1, 4)   [8, 10)  [15, 16)</span>

<span class="fu"><a href="../reference/iv-sets.html">iv_union</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [-5, 0)  [1, 5)   [8, 12)  [13, 16)</span></code></pre></div>
<p><code><a href="../reference/iv-sets.html">iv_intersect()</a></code> takes the intersection of two ivs. It answers the question, “Which intervals are in <code>x</code> and <code>y</code>?”</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-sets.html">iv_intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[1]&gt;</span>
<span class="co">#&gt; [1] [1, 4)</span></code></pre></div>
<p><code><a href="../reference/iv-sets.html">iv_difference()</a></code> takes the asymmetrical difference of two ivs. It answers the question, “Which intervals are in <code>x</code> but not <code>y</code>?”</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-sets.html">iv_difference</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [4, 5)   [10, 12) [13, 15)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pairwise-set-operations">Pairwise set operations<a class="anchor" aria-label="anchor" href="#pairwise-set-operations"></a>
</h2>
<p>The set operations described above all treat <code>x</code> and <code>y</code> as two complete “sets” of intervals and operate on the intervals as a group. Occasionally it is useful to have pairwise equivalents of these operations that, say, take the intersection of the i-th interval of <code>x</code> and the i-th interval of <code>y</code>.</p>
<p>One case in particular comes from combining <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code> with <code><a href="../reference/iv-set-pairwise.html">iv_pairwise_intersect()</a></code>. Here you might want to know not only <em>where</em> two ivs overlaps, but also <em>what</em> that intersection was for each value in <code>x</code>.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-01-05"</span>, <span class="st">"2019-01-20"</span>, <span class="st">"2019-01-25"</span>, <span class="st">"2019-02-01"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ends</span> <span class="op">&lt;-</span> <span class="va">starts</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">starts</span>, <span class="va">ends</span><span class="op">)</span>

<span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-01-02"</span>, <span class="st">"2019-01-23"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ends</span> <span class="op">&lt;-</span> <span class="va">starts</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="va">starts</span>, <span class="va">ends</span><span class="op">)</span>

<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;date&gt;[4]&gt;</span>
<span class="co">#&gt; [1] [2019-01-05, 2019-01-10) [2019-01-20, 2019-01-30) [2019-01-25, 2019-01-28)</span>
<span class="co">#&gt; [4] [2019-02-01, 2019-02-06)</span>
<span class="va">y</span>
<span class="co">#&gt; &lt;iv&lt;date&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [2019-01-02, 2019-01-07) [2019-01-23, 2019-01-29)</span></code></pre></div>
<p><code><a href="../reference/iv-sets.html">iv_intersect()</a></code> isn’t very useful to answer this particular question, because it first merges all overlapping intervals in each input.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-sets.html">iv_intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;date&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [2019-01-05, 2019-01-07) [2019-01-23, 2019-01-29)</span></code></pre></div>
<p>Instead, we can find the overlaps and align them, and then pairwise intersect the results:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relation-locate.html">iv_locate_overlaps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, no_match <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>
<span class="va">overlaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv_align.html">iv_align</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, locations <span class="op">=</span> <span class="va">locations</span><span class="op">)</span>

<span class="va">overlaps</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intersect <span class="op">=</span> <span class="fu"><a href="../reference/iv-set-pairwise.html">iv_pairwise_intersect</a></span><span class="op">(</span><span class="va">needles</span>, <span class="va">haystack</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                    needles                 haystack                intersect</span>
<span class="co">#&gt; 1 [2019-01-05, 2019-01-10) [2019-01-02, 2019-01-07) [2019-01-05, 2019-01-07)</span>
<span class="co">#&gt; 2 [2019-01-20, 2019-01-30) [2019-01-23, 2019-01-29) [2019-01-23, 2019-01-29)</span>
<span class="co">#&gt; 3 [2019-01-25, 2019-01-28) [2019-01-23, 2019-01-29) [2019-01-25, 2019-01-28)</span></code></pre></div>
<p>Note that the pairwise set operations come with a number of restrictions that limit their usage in many cases. For example, <code><a href="../reference/iv-set-pairwise.html">iv_pairwise_intersect()</a></code> requires that <code>x[i]</code> and <code>y[i]</code> overlap, otherwise they would result in an empty interval, which isn’t allowed.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/iv-set-pairwise.html">iv_pairwise_intersect</a></span><span class="op">(</span><span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="../reference/iv.html">iv</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `iv_pairwise_intersect()`:</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't take the intersection of non-overlapping intervals.</span>
<span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> This would result in an empty interval.</span>
<span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Location 1 contains non-overlapping intervals.</span></code></pre></div>
<p>See the documentation page of <code><a href="../reference/iv-set-pairwise.html">iv_pairwise_intersect()</a></code> for a complete list of restrictions for all of the pairwise set operations.</p>
</div>
<div class="section level2">
<h2 id="missing-intervals">Missing intervals<a class="anchor" aria-label="anchor" href="#missing-intervals"></a>
</h2>
<p>Missing intervals are allowed in iv, you can generate them by supplying vectors to <code><a href="../reference/iv.html">iv()</a></code> or <code><a href="../reference/iv.html">iv_pairs()</a></code> that contain missing values in either input.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span>
<span class="co">#&gt; [1] [1, 5)   [NA, NA) [NA, NA)</span></code></pre></div>
<p>The defaults of all functions in iv treat missing intervals in one of two ways:</p>
<ul>
<li><p>Set-like operations treat missing intervals as <em>overlapping</em> other missing intervals, but they won’t overlap any other interval. These include <code><a href="../reference/relation-locate.html">iv_locate_overlaps()</a></code>, <code><a href="../reference/iv-sets.html">iv_intersect()</a></code>, and <code><a href="../reference/iv-splits.html">iv_splits()</a></code>.</p></li>
<li><p>Pairwise operations treat missing intervals as <em>infectious</em>, meaning that if the i-th interval of <code>x</code> is missing and the i-th interval of <code>y</code> is not missing (or vice versa), then the result is forced to be a missing interval. These include any operations prefixed with <code>iv_pairwise_*()</code>.</p></li>
</ul>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [NA, NA) [0, 2)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set-like operations treat missing intervals as overlapping</span>
<span class="fu"><a href="../reference/relation-locate.html">iv_locate_overlaps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt;   needles haystack</span>
<span class="co">#&gt; 1       1        2</span>
<span class="co">#&gt; 2       2        1</span>
<span class="co">#&gt; 3       3        1</span>

<span class="fu"><a href="../reference/iv-sets.html">iv_intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [1, 2)   [NA, NA)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Pairwise operations treat missing intervals as infectious</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iv.html">iv_pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/iv-set-pairwise.html">iv_pairwise_intersect</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">z</span><span class="op">)</span>
<span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span>
<span class="co">#&gt; [1] [NA, NA) [1, 2)</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Davis Vaughan, RStudio.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
